# Setup guide for pilot libraries

OCR-D's software is a modular collection of many projects (called _modules_) with many tools per
project (called _processors_) that you can combine freely to achieve the workflow best suited for
OCRing your content.

All [OCR-D modules](https://github.com/topics/ocr-d) follow the same [interface](https://ocr-d.github.io/cli) and common design patterns so
once you understand how to install and use one project, you know
how to install and use all of them.

## Installation

There are usually three approaches to installing OCR-D modules:

  1. With Docker (recommended, but not always available or up to date)
  2. Local installation from PyPI (for Python modules only)
  3. Local installation from source (most flexible)

For the local installation approaches, we strongly recommend to use a [virtualenv](https://virtualenv.pypa.io/en/stable/userguide/) and using GNU/Linux **Ubuntu >= 18.04** as host OS.

All [OCR-D modules](https://github.com/topics/ocr-d) come with a README file with an `Installation` section that
should explain the options available.

For example, to install the
[`ocrd_tesserocr`](https://github.com/OCR-D/ocrd_tesserocr), the three options
are:

### With Docker

This is the best option if you want to run the software in a container. It encapsulates all requirements (system and Python packages).

You need to have [Docker](https://docs.docker.com/install/linux/docker-ce/ubuntu/)

```sh
docker pull ocrd/tesserocr
```

### Local installation

> **NOTE**
> 
> ocrd_tesserocr requires **tesseract-ocr >= 4.1.0**. But the Tesseract packages
> bundled with **Ubuntu < 19.10** are too old. If you are on Ubuntu 18.04 LTS,
> please enable [Alexander Pozdnyakov PPA](https://launchpad.net/~alex-p/+archive/ubuntu/tesseract-ocr),
> which has up-to-date builds of tesseract and its dependecies:
> 
> ```sh
> sudo add-apt-repository ppa:alex-p/tesseract-ocr
> sudo apt-get update
> ```

#### From PyPI

This is the best option if you want to use the stable, released version.

However, you first require a number of non-Python (system) packages. For the exact list of packages you need to look at the README. (If you are not on Ubuntu >= 18.04, then your requirements may deviate from that.)

```sh
sudo apt-get install git python3 python3-pip libtesseract-dev libleptonica-dev tesseract-ocr-eng tesseract-ocr wget
pip3 install ocrd_tesserocr
```

#### From git 

This is the best option if you want to change the source code or install the latest, unpublished changes.

```sh
git clone https://github.com/OCR-D/ocrd_tesserocr
cd ocrd_tesserocr
make deps-ubuntu # or manually with apt-get
make deps        # or pip3 install -r requirements
make install     # or pip3 install .
```

## Testing the installation

For example, let's fetch a document from the [OCR-D GT Repo](https://ocr-d-repo.scc.kit.edu/api/v1/metastore/bagit/):

```sh
wget 'https://ocr-d-repo.scc.kit.edu/api/v1/dataresources/736a2f9a-92c6-4fe3-a457-edfa3eab1fe3/data/wundt_grundriss_1896.ocrd.zip'
unzip wundt_grundriss_1896.ocrd.zip
cd data
```

### Local installation

If you installed a package [from PyPI](#from-pypi) or [from Git](#from-git), you
can run the OCR-D processors directly from your command line.

Let's segment the images in file group `OCR-D-IMG` into regions (creating a first [PAGE-XML](https://github.com/PRImA-Research-Lab/PAGE-XML) file group `OCR-D-SEG-BLOCK`):

```
ocrd-tesserocr-segment-region -I OCR-D-IMG -O OCR-D-SEG-BLOCK
```

### With docker

You can spin up a docker container, mounting the current working directory like this:


```sh
docker run -u $(id -u) -w /data -v $PWD:/data -- ocrd/tesserocr ocrd-tesserocr-segment-region -I OCR-D-IMG -O OCR-D-SEG-BLOCK-DOCKER
```

Note that the CLI is exactly the same, the only difference is the prefix to instruct Docker.

## Running a small workflow

### With PyPI and workflow engine from core

The [core package](https://github.com/OCR-D/core) will be installed with every OCR-D module package, but you can also install it manually like this:

```sh
pip3 install ocrd
```

Its CLI `ocrd` contains a simple workflow engine, available with the `ocrd process` command, which allows you to chain multiple OCR-D processor calls into simple sequential workflows.

For example, let's combine the ocropy-based binarization of the
[ocrd_cis](https://github.com/cisocrgroup/ocrd_cis) module project with the segmentation and recognition
in [ocrd_tesserocr](https://github.com/OCR-D/ocrd_tesserocr).

First, install ocrd_cis, too:

```sh
# Install ocrd_cis
pip3 install ocrd_cis # with pip
```

Next, install a suitable OCR model for Tesseract:

```sh
# Install OCR model into Tesseract datapath
sudo apt-get install tesseract-ocr-script-frak
```

Now we can define the workflow (as a list of processor calls in abbreviated form, and a number of parameter files where defaults are insufficient):

```sh
# Create parameter files
echo '{ "model": "script/Fraktur" }' > param-tess-fraktur.json

# Run workflow
ocrd process \
  'cis-ocropy-binarize -I OCR-D-IMG -O OCR-D-SEG-PAGE' \
  'tesserocr-segment-region -I OCR-D-SEG-PAGE -O OCR-D-SEG-BLOCK' \
  'tesserocr-segment-line -I OCR-D-SEG-BLOCK -O OCR-D-SEG-LINE' \
  'tesserocr-recognize -I OCR-D-SEG-LINE -O OCR-D-OCR-TESSEROCR -p param-tess-fraktur.json' 
```
